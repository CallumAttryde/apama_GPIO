using com.apamax.rpi.spi.SPI;

monitor BasicSPI {
	/** @private */
	SPI SPIPlugin;
	
	action onload() {
		log "OnLoad reached!";
		SPIPlugin := (new SPI);
		boolean result := SPIPlugin.init(0, 500000);

		if(not result) {
			log "Failed to setup";
			die;
		}
		else {
			log "Setup succeeded";
		}

		integer i := 0;
		sequence<integer> send;
		send.add(1);
		sequence<integer> recieve;
		while(i < 10)
		{
			send[0] = 1;
			receive = SPIPlugin.readWrite(send);
			log "Writing 1 to SPI";
			SPIPlugin.delay(2000);
			send[0] = 0;
			receive = SPIPlugin.readWrite(send);
			log "Writing 0 to SPI";
			SPIPlugin.delay(2000);

			i := i + 1;
		}
	}
}

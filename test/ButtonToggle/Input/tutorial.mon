using com.apamax.rpi.gpio.Setup;
using com.apamax.rpi.gpio.LED;
using com.apamax.rpi.gpio.Button;

monitor ButtonToggle {

	boolean toggle := false;
	LED led1;
	LED led2;
	
	action onload() {
		// Setup GPIO access to the pins
		(new Setup).setInputPins([22]).setOutputPins([17, 27]).init();
		
		led1 := (new LED).init(17, toggle);
		led2 := (new LED).init(27, not toggle);
		
		integer buttonPin := 22;
		Button button := (new Button).init(buttonPin);
		
		// Setup a listener for the ButtonPush on buttonPin
		on all com.apamax.rpi.gpio.ButtonPush(pin=buttonPin) {
			log "Button Pressed" at INFO;
			led1.set(toggle);
			toggle := not toggle;
			led2.set(toggle);
		}
	}
}